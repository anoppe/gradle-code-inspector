task validateMongoScripts {
    description 'Check if mongo migration scripts do not contain illegal statements'
    doFirst {

        def invalidFiles = new ArrayList<String>()

        fileTree('.').filter { it.name.endsWith('.js') }.files.forEach { file ->
            int i = 0
            file.eachLine { line ->
                i++
                // if a line is appended with  'NOVALIDATION' we ignore it
                if (!line.trim().endsWith('NOVALIDATION') && line.contains('new Mongo()')) {
                    invalidFiles.add("$file.name @ L$i")
                }
            }
        }

        if (!invalidFiles.isEmpty()) {
            invalidFiles.each { fileAndLineNumber ->
                println fileAndLineNumber
            }

            throw new Exception("Illegal statement found in files")
        }

    }
}

